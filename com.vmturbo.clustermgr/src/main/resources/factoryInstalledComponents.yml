# This represents a "factory-configured" list of the VmtComponent types we know of a-priori. This property is used
#      to initialize the Consul key/value store. Going forward, new VmtComponent types may be added via the API.
action-orchestrator:
  marketHost: 'market'
  topologyProcessorHost: 'topology-processor'
  groupHost: 'group'
  <<: &db_conn_info
    dbHost: 'db'
    dbPort: 3306
    dbUsername: 'root'
    sqlDialect: 'MARIADB'
  dbSchemaName: 'action'
  <<: &auth_conn_info
    authHost: 'auth'
    authPort: 8080
    authRetryDelaySecs: 30
  grpcPingIntervalSeconds: 300
  websocket.pong.timeout: 30000
  actionPaginationDefaultLimit: 100
  actionPaginationMaxLimit: 500
  mariadbHealthCheckIntervalSeconds: 60
  repositoryHost: 'repository'
  entityTypeRetryIntervalMillis: 1000
  entityTypeMaxRetries: 6
  maxLiveActionPlanAgeSeconds: 600
  <<: &baseVmtComponentSettings
    consul_host: consul
    consul_port: 8500
    server_port: 8080
    server.grpcPort: 9001
    deadlockCheckIntervalSecs: 900
    maxHealthyUsedMemoryRatio: 0.95
    scheduledMetricsIntervalMs: 60000
    kvStoreRetryIntervalMillis: 1000
  #temp fix to resolve conflict between action.orchestrator.api project and
  #    action.orchestrator.api package in AO
  actionOrchestratorHost: 'action-orchestrator'


market:
  <<: *baseVmtComponentSettings
  topologyProcessorHost: 'topology-processor'
  grpcPingIntervalSeconds: 300
  identityGeneratorPrefix: 2
  websocket.pong.timeout: 30000
  groupHost: 'group'

topology-processor:
  <<: *baseVmtComponentSettings
  # database-related properties.
  <<: *db_conn_info
  # This should be in sync with the schema in the Topology Processor's pom.xml
  dbSchemaName: 'topology_processor'
  sqlDialect: 'MARIADB'
  mariadbHealthCheckIntervalSeconds: 60
  # END - database-related properties

  # authentication-related properties
  <<: *auth_conn_info

  # 30 seconds to match the hardcoded timeout value on the probe side.
  # 4 keep-alive messages are sent by the client during this interval.
  discoveryTimeoutSeconds: 30
  validationTimeoutSeconds: 30
  topologyBroadcastIntervalMinutes: 10
  actionTimeoutSeconds: 30
  groupHost: 'group'
  historyHost: 'history'
  planOrchestratorHost: 'plan-orchestrator'
  repositoryHost: 'repository'
  grpcPingIntervalSeconds: 300
  identityGeneratorPrefix: 1
  # Urgent metrics are collected every 10 minutes, the offline every 3 days
  collectionIntervalUrgentSec: 600
  collectionIntervalOfflineSec: 259200
  anonymized: 'true'
  bridgeHost: 'clustermgr'
  bridgePort: 8120
  discoveredGroupUploadIntervalSeconds: 10
  # The interval at which to attempt to reload assigned IDs
  # after topology processor startup.
  assignedIdReloadReattemptIntervalSeconds: 10
  # This configuration value controls how often the commodity max values are
  # loaded from history component.
  maxValuesBackgroundLoadFrequencyMinutes: 180 # 3 hours
  # This configuration value controls the initial delay before triggering
  # the background load task when the initial load during startup fails.
  # For subsequent fetches from the DB or when the initial load succeeds,
  # the delay will be based on the maxValuesBackgroundLoadFrequencyMinutes
  # config value.
  maxValuesBackgroundLoadDelayOnInitFailureMinutes : 30

repository:
  <<: *baseVmtComponentSettings
  topologyProcessorHost: 'topology-processor'
  actionOrchestratorHost: 'action-orchestrator'
  grpcPingIntervalSeconds: 300
  websocket.pong.timeout: 30000
  arangodbHealthCheckIntervalSeconds: 60
  realtimeTopologyContextId: 777777
  <<: *auth_conn_info

group:
  <<: *baseVmtComponentSettings
  repositoryHost: 'repository'
  # TODO: Remove from source control and instead get these values from the auth component.
  arangodbPort: 8529
  arangodbHost: arangodb
  arangodbUser: root
  arangodbHealthCheckIntervalSeconds: 60
  mariadbHealthCheckIntervalSeconds: 60
  grpcPingIntervalSeconds: 300
  identityGeneratorPrefix: 4
  createDefaultSettingPolicyRetryIntervalSec: 30
  tempGroupExpirationTimeMins: 10

  # START - database-related properties.
  <<: *db_conn_info
  # This should be in sync with the schema in the component's pom.xml
  # Because 'group' is a keyword in SQL, name the schema 'group_component'
  dbSchemaName: 'group_component'
  sqlDialect: 'MARIADB'
  mariadbHealthCheckIntervalSeconds: 60
  # END - database-related properties
  <<: *auth_conn_info

api:
  <<: *baseVmtComponentSettings
  clusterMgrHost: 'clustermgr'
  topologyProcessorHost: 'topology-processor'
  actionOrchestratorHost: 'action-orchestrator'
  repositoryHost: 'repository'
  planOrchestratorHost: 'plan-orchestrator'
  groupHost: 'group'
  historyHost: 'history'
  reportingHost: 'reporting'
  identityGeneratorPrefix: 5
  keystoreFile: '/home/turbonomic/data/keystore.p12'
  keystoreType: 'PKCS12'
  keystoreAlias: 'vmt'
  grpcPingIntervalSeconds: 300
  websocket.pong.timeout: 30000
  targetValidationTimeoutSeconds: 120
  targetValidationPollIntervalSeconds: 2
  supplyChainFetcherTimeoutSeconds: 360
  publicVersionString: 7.1.0
  groupBuildUseCaseFile: 'groupBuilderUsecases.json'
  settingManagersFile: 'settingManagers.json'
  settingStyleFile: 'settingSpecStyle.json'
  initialPlacementTimeoutSeconds: 600
  externalApiSwaggerUri: "/vmturbo/apidoc/**"
  externalApiFileSystemBase: "file:/swagger/"
  <<: *auth_conn_info

auth:
  <<: *baseVmtComponentSettings
  <<: *db_conn_info
  dbSchemaName: 'auth'
  sqlDialect: 'MARIADB'
  mariadbHealthCheckIntervalSeconds: 60
  grpcPingIntervalSeconds: 300
  identityGeneratorPrefix: 7

mediation-vcenter:
  <<: *baseVmtComponentSettings
  <<: &commonMediationComponentSettings
    serverAddress: 'ws://topology-processor:8080/remoteMediation'
    silentRetryTime: 0
    connRetryIntervalSeconds: 10
    sslKeystorePassword: ' '
    sslKeystorePath: ' '
    userName: vmtRemoteMediation
    userPassword: vmtRemoteMediation
    grpcPingIntervalSeconds: 300
    websocket.pong.timeout: 30000

mediation-hyperv:
  <<: *baseVmtComponentSettings
  <<: *commonMediationComponentSettings

mediation-netapp:
  <<: *baseVmtComponentSettings
  <<: *commonMediationComponentSettings

mediation-ucs:
  <<: *baseVmtComponentSettings
  <<: *commonMediationComponentSettings

mediation-vmax:
  <<: *baseVmtComponentSettings
  <<: *commonMediationComponentSettings

mediation-vmm:
  <<: *baseVmtComponentSettings
  <<: *commonMediationComponentSettings

plan-orchestrator:
  <<: *baseVmtComponentSettings
  <<: *db_conn_info
  historyHost: 'history'
  groupHost: 'group'
  grpcPingIntervalSeconds: 300
  # TODO: Remove from source control and instead get these values from the auth component.
  dbSchemaName: 'plan'
  <<: *auth_conn_info
  mariadbHealthCheckIntervalSeconds: 60
  actionOrchestratorHost: 'action-orchestrator'
  topologyProcessorHost: 'topology-processor'
  repositoryHost: 'repository'
  historyHost: 'history'
  # cron spec for running cluster rollup at 1AM daily: second (0-60) ,minute (0-59), hour(0-23),
  #     day of month(1-31), month(1-12), day of week(0-7, 7=sun)
  clusterRollupSchedule: "0 0 1 * * *"
  # Run plan deletion at 2AM everyday
  planDeletionSchedule: "0 0 2 * * *"
  # Config parameter to control the batch size for deleting old plans.
  planDeletionBatchSize: 500
  # Delay before the next batch of old plans is deleted.
  planDeletionDelayBetweenDeletesSeconds: 120
  grpcPingIntervalSeconds: 300
  identityGeneratorPrefix: 3
  websocket.pong.timeout: 30000
  templateSpecFile: "defaultTemplateSpec.json"
  defaultTemplatesFile: "defaultTemplates.json"
  # Config parameter to control the time out hours for running plan.
  # If this value is changed, update defaultTimeOutHour value in PlanDaoImplTest#testCleanUpTimeOutedPlans
  planTimeOutHours: 6

history:
  <<: *baseVmtComponentSettings
  topologyProcessorHost: 'topology-processor'
  writeTopologyChunkSize: 1000
  userName: vmtplatform
  requestHost: '%'
  adapter: mysql
  hostName: db
  portNumber: 3306
  databaseName: vmtdb
  readonlyUserName: vmtreader
  readonlyPassword: vmturbo
  queryTimeoutSeconds: 120
  migrationTimeoutSeconds: 600
  numRetainedMinutes: 120
  latestTableTimeWindowMin: 15
  numRetainedHours: 72
  numRetainedDays: 60
  mariadbHealthCheckIntervalSeconds: 60
  # note: excluded commodities are case-insensitive, but in mixed case here for readability
  # and to match exactly the values from discovery
  # list obtained from $legacy/com.vmturbo.components.common/src/main/java/com/vmturbo/components/common/ClassicEnumMapper.java
  # The commodities for which stats are not maintained/tracked in the DB. These are typically access commodities.
  excludedCommodities: ApplicationCommodity CLUSTERCommodity DATACENTERCommodity DATASTORECommodity DRSSEGMENTATIONCommodity DSPMAccessCommodity NETWORKCommodity SEGMENTATIONCommodity STORAGECLUSTERCommodity VAPPAccessCommodity VDCCommodity VMPMAccessCommodity
  topologyProcessorHost: topology-processor
  grpcPingIntervalSeconds: 300
  websocket.pong.timeout: 30000
  <<: *auth_conn_info

reporting:
  <<: *baseVmtComponentSettings
  <<: *db_conn_info
  dbSchemaName: 'vmtdb'
  <<: *auth_conn_info
  identityGeneratorPrefix: 8
  scheduledReportsGenerationTime: 1
  groupHost: 'group'
  grpcPingIntervalSeconds: 300
