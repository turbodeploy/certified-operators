#
# DevelopmentVersion
#
# Docker Container Settings for Turbonomic XL 1.0.0 - for 15K Service Entities.
# A VM size of 16G is recommended.
#
version: '2'

networks:
  default:
    ipam:
      driver: default
      config:
      - subnet: 10.10.10.0/24
        gateway: 10.10.10.1

volumes:
  consuldata: &localdriver
    driver: local
  syslogdata: *localdriver
  syslogdata_rotate: *localdriver
  auditlogdata: *localdriver
  mysqldata: *localdriver
  mysql_var: *localdriver
  mysql_log: *localdriver
  arangodb: *localdriver
  arangodb-apps: *localdriver
  arangodb-dump: *localdriver
  influxdb: *localdriver
  influxdb-dump: *localdriver
  clustermgr: *localdriver
  api: *localdriver
  auth: *localdriver
  topology-processor: *localdriver
  reporting: *localdriver
  mediation-aws: *localdriver
  mediation-awsbilling: *localdriver
  mediation-awscost: *localdriver
  mediation-datadog: *localdriver
  mediation-azure: *localdriver
  mediation-azurecost: *localdriver
  kafka1-log: *localdriver
  zoo1-data: *localdriver
  nginx-data: *localdriver
  nginx-run: *localdriver
  nginx-home: *localdriver

services:
  rsyslog:
    extends:
      file: common-services.yml
      service: common-service
    image: turbonomic/syslog:${XL_VERSION}
    volumes:
      - syslogdata:/home/vmtsyslog
      - syslogdata_rotate:/var/lib/logrotate
      - auditlogdata:/var/log/turbonomic
    restart: always

  consul:
    extends:
      file: common-services.yml
      service: common-service
    image: turbonomic/com.vmturbo.consul:${XL_VERSION}
    command: ["vmt-server", "-client=0.0.0.0", "-ui"]
    environment:
      - CONSUL_BIND_INTERFACE=eth0
      - "constraint:node==/node-4/"
    networks:
      default:
        # choose an address high enough to avoid IPs for other components that docker will assign
        ipv4_address: 10.10.10.128
    ports:
      - "${CONSUL_PORT}"
    volumes:
      - consuldata:/consul/data
    restart: always
    mem_limit: 50M
    depends_on:
      - rsyslog
  db:
    extends:
      file: common-services.yml
      service: common-service
    image: turbonomic/db:${XL_VERSION}
    volumes:
      - mysqldata:/var/lib/mysql
      - mysql_log:/var/log
      - mysql_var:/var/run
    ports:
      - "${DB_PORT}"
    mem_limit: ${DB_MEM_LIMIT_MB}M
    depends_on:
      - rsyslog
    environment:
        DB_MEM_PCT_FOR_BUFFER_POOL: ${DB_MEM_PCT_FOR_BUFFER_POOL}

  zoo1:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/zookeeper:${XL_VERSION}
    restart: always
    mem_limit: ${ZOOKEEPER_MEM_LIMIT}M
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: zoo1
    volumes:
      - zoo1-data:/var/lib/zoo

  kafka1:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/kafka:${XL_VERSION}
    mem_limit: ${KAFKA_MEM_LIMIT}M
    environment:
      BROKER_ID: 1
      ZOOKEEPER_HOSTS: ${ZOOKEEPER_SERVERS}
      KAFKA_INTERNAL_PORT: ${KAFKA_INTERNAL_PORT}
      KAFKA_INTERNAL_BROKER_ADDRESS: ${KAFKA_INTERNAL_BROKER_ADDRESS}
      KAFKA_EXTERNAL_PORT: ${KAFKA_EXTERNAL_PORT}
      KAFKA_EXTERNAL_BROKER_ADDRESS: ${KAFKA_EXTERNAL_BROKER_ADDRESS}
      KAFKA_LOG_RETENTION_HRS: ${KAFKA_LOG_RETENTION_HRS}
      KAFKA_MAX_MESSAGE_BYTES: ${KAFKA_MAX_MESSAGE_BYTES}
    volumes:
      - kafka1-log:/home/kafka/data
    ports:
      # the external port mapping will have to be revisited for clustering, where external ports
      # would need to be unique per-host.
      - "${KAFKA_EXTERNAL_PORT}:${KAFKA_EXTERNAL_PORT}"
    depends_on:
      - rsyslog
      - zoo1

  auth:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/auth:${XL_VERSION}
    depends_on:
      - clustermgr
      - consul
      - db
    ports:
      - "${AUTH_PORT}"
      - "${AUTH_DEBUG_PORT}"
    environment:
      component_type: auth
      instance_id: auth-1
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${AUTH_SYSTEM_PROPERTIES}"
    volumes:
      - auth:/home/turbonomic/data
    mem_limit: ${AUTH_MEM_LIMIT_MB}M

  clustermgr:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/com.vmturbo.clustermgr:${XL_VERSION}
    depends_on:
      - consul
      - rsyslog
      - kafka1
    ports:
      - "${CLUSTERMGR_PORT}"
      - "${CLUSTERMGR_DEBUG_PORT}"
    environment:
      component_type: clustermgr
      instance_id: clustermgr-1
      serverHttpPort: 8080
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${CLUSTERMGR_SYSTEM_PROPERTIES}"
      node_name: default
      consul_host: consul
      kafkaServers: ${KAFKA_SERVERS}
    volumes:
      - clustermgr:/home/turbonomic/data
    mem_limit: ${CLUSTERMGR_MEM_LIMIT_MB}M

  api:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/com.vmturbo.api.component:${XL_VERSION}
    depends_on:
      - clustermgr
      - kafka1
      - nginx
    ports:
      - "${API_HTTP_PORT}"
      - "${API_DEBUG_PORT}"
    environment:
      component_type: api
      instance_id: api-1
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${API_SYSTEM_PROPERTIES}"
    volumes:
      - api:/home/turbonomic/data
      - /tmp/certs:/tmp/certs
# customize this line to mount your ux development folder directly on the /www folder in the api
#      - /Users/...user.../...path-to-ux-app-folder.../ux-app/.tmp:/www:ro
    mem_limit: ${API_MEM_LIMIT_MB}M

  nginx:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/nginx:${XL_VERSION}
    ports:
      - "${NGINX_HTTP_PORT}"
      - "${NGINX_HTTPS_PORT}"
    environment:
      API: api
      TOPOLOGY: topology-processor
      DNS_RESOLVER: 127.0.0.11
    volumes:
      - /tmp/certs:/etc/nginx/certs
      - /tmp/load_status:/var/www/load_status
      - nginx-data:/var/cache/nginx
      - nginx-run:/var/run
      - nginx-home:/home/nginx

  market:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/market-component:${XL_VERSION}
    depends_on: &clustermgrdep
      - clustermgr
      - kafka1
    ports:
      - "${MARKET_PORT}"
      - "${MARKET_DEBUG_PORT}"
    environment:
      component_type: market
      instance_id: market-1
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MARKET_SYSTEM_PROPERTIES}"
    mem_limit: ${MARKET_MEM_LIMIT_MB}M

  action-orchestrator:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/action-orchestrator:${XL_VERSION}
    depends_on:
      - db
      - auth
      - clustermgr
      - kafka1
    ports:
      - "${ACTION_ORCHESTRATOR_PORT}"
      - "${ACTION_ORCHESTRATOR_DEBUG_PORT}"
    environment:
      component_type: action-orchestrator
      instance_id: action-orchestrator-1
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${ACTION_ORCHESTRATOR_SYSTEM_PROPERTIES}"
    mem_limit: ${ACTION_ORCHESTRATOR_MEM_LIMIT_MB}M

  topology-processor:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/topology-processor:${XL_VERSION}
    ports:
      - "${TOPOLOGY_PROCESSOR_PORT}"
      - "${TOPOLOGY_PROCESSOR_DEBUG_PORT}"
    depends_on:
      - db
      - clustermgr
      - kafka1
      - auth
    environment:
      component_type: topology-processor
      instance_id: topology-processor-1
      node_name: default
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${TOPOLOGY_PROCESSOR_SYSTEM_PROPERTIES}"
    volumes:
      - topology-processor:/home/turbonomic/data
    mem_limit: ${TOPOLOGY_PROCESSOR_MEM_LIMIT_MB}M

  sample:
    extends:
      file: common-services.yml
      service: dev-component
    # The image, created by the docker-maven-plugin, has the
    # name turbonomic/<artifactId from pom>
    image: turbonomic/sample:${XL_VERSION}
    depends_on:
      - clustermgr
    # These are the ports that get exposed outside the container network.
    # The ports on the left-hand side should be globally unique.
    ports:
       # The values for these environment variables are in the XL/build/.env file.
       # See: https://docs.docker.com/compose/env-file/
       #
       # 8080 is the port for the HTTP server (defined in bootstrap.yml).
       # The left-hand side (8091) is the port on the host that will map to 8080.
       # So to access the HTTP server you will go to: <docker-host>:8091.
       - "${SAMPLE_PORT}"
       # 8000 is the debug port for the JVM. You will use the left-hand side port (20007) when
       # connecting to the container from a debugger/IDE.
       - "${SAMPLE_DEBUG_PORT}"
    environment:
      component_type: sample
      instance_id: sample-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${SAMPLE_SYSTEM_PROPERTIES}"

  arangodb:
    extends:
      file: common-services.yml
      service: common-service
    image: turbonomic/arangodb:${XL_VERSION}
    environment:
      ARANGO_ROOT_PASSWORD: "root"
    ports:
      - "${ARANGODB_PORT}"
      - "${ARANGODB_DUMP_PORT}"
    volumes:
      - arangodb:/var/lib/arangodb3
      - arangodb-apps:/var/lib/arangodb3-apps
      - arangodb-dump:/home/arangodb/arangodb-dump
    mem_limit: ${ARANGODB_MEM_LIMIT_MB}M

  influxdb:
    extends:
      file: common-services.yml
      service: common-service
    image: turbonomic/influxdb:${XL_VERSION}
    environment:
      METRON_ENABLED: "${METRON_ENABLED}"
      LOG_TO_STDOUT: "true"
      # Uncomment to specify the dump interval for influx. Default is once per day if unspecified.
      # INFLUX_DUMP_INTERVAL_SECONDS: 300
    ports:
      - "${INFLUXDB_PORT}"
      - "${INFLUXDB_DUMP_PORT}"
    volumes:
      - influxdb:/var/lib/influxdb
      - influxdb-dump:/home/influxdb/influxdb-dump
    mem_limit: ${INFLUXDB_MEM_LIMIT_MB}M

  ml-datastore:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/ml-datastore:${XL_VERSION}
    ports:
      - "${ML_DATASTORE_PORT}"
      - "${ML_DATASTORE_DEBUG_PORT}"
    depends_on:
      - influxdb
      - clustermgr
      - kafka1
      - auth
    environment:
      component_type: ml-datastore
      instance_id: ml-datastore-1
      kafkaServers: ${KAFKA_SERVERS}
      METRON_ENABLED: "${METRON_ENABLED}"
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${ML_DATASTORE_SYSTEM_PROPERTIES}"
    mem_limit: ${ML_DATASTORE_MEM_LIMIT_MB}M

  repository:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/com.vmturbo.repository-component:${XL_VERSION}
    ports:
      - "${REPOSITORY_PORT}"
      - "${REPOSITORY_DEBUG_PORT}"
    depends_on:
      - arangodb
      - clustermgr
      - kafka1
      - auth
    environment:
      component_type: repository
      instance_id: repository-1
      REPOSITORY_ARANGODB_HOST: arangodb
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${REPOSITORY_SYSTEM_PROPERTIES}"
    mem_limit: ${REPOSITORY_MEM_LIMIT_MB}M

  group:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/com.vmturbo.group:${XL_VERSION}
    ports:
      - "${GROUP_PORT}"
      - "${GROUP_DEBUG_PORT}"
    depends_on:
      - clustermgr
      - db
      - auth
    environment:
      component_type: group
      instance_id: group-1
      logging.level.com.vmturbo.group: info # change to debug to enable more debugging output
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${GROUP_SYSTEM_PROPERTIES}"
      kafkaServers: ${KAFKA_SERVERS}
    mem_limit: ${GROUP_MEM_LIMIT_MB}M

  history:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/com.vmturbo.history:${XL_VERSION}
    ports:
      - "${HISTORY_PORT}"
      - "${HISTORY_DEBUG_PORT}"
    depends_on:
      - db
      - clustermgr
      - kafka1
      - auth
    environment:
      component_type: history
      instance_id: history-1
      logging.level.com.vmturbo.history: INFO
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${HISTORY_SYSTEM_PROPERTIES}"
    mem_limit: ${HISTORY_MEM_LIMIT_MB}M

  plan-orchestrator:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/com.vmturbo.plan.orchestrator:${XL_VERSION}
    ports:
      - "${PLAN_ORCHESTRATOR_PORT}"
      - "${PLAN_ORCHESTRATOR_DEBUG_PORT}"
    depends_on:
      - db
      - clustermgr
      - kafka1
      - auth
    environment:
      component_type: plan-orchestrator
      instance_id: plan-orchestrator-1
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${PLAN_ORCHESTRATOR_SYSTEM_PROPERTIES}"
    mem_limit: ${PLAN_ORCHESTRATOR_MEM_LIMIT_MB}M

  reporting:
    extends:
      file: common-services.yml
      service: dev-component
    image: turbonomic/com.vmturbo.reports.component:${XL_VERSION}
    ports:
      - "${REPORTING_PORT}"
      - "${REPORTING_DEBUG_PORT}"
    depends_on:
      - db
      - clustermgr
      - auth
    volumes:
      - reporting:/home/turbonomic/data
    environment:
      component_type: reporting
      instance_id: reporting-1
      report.files.output.dir: /home/turbonomic/data
      kafkaServers: ${KAFKA_SERVERS}
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${REPORTING_SYSTEM_PROPERTIES}"
    mem_limit: ${REPORTING_MEM_LIMIT_MB}M

  cost:
      extends:
        file: common-services.yml
        service: dev-component
      image: turbonomic/com.vmturbo.cost.component:${XL_VERSION}
      ports:
        - "${COST_PORT}"
        - "${COST_DEBUG_PORT}"
      depends_on:
        - clustermgr
        - db
        - kafka1
        - auth
      environment:
        component_type: cost
        instance_id: cost-1
        logging.level.com.vmturbo.cost: info # change to debug to enable more debugging output
        JAVA_OPTS: "${DEV_JAVA_OPTS} ${COST_SYSTEM_PROPERTIES}"
        kafkaServers: ${KAFKA_SERVERS}
      mem_limit: ${COST_MEM_LIMIT_MB}M

  mediation-vcenter:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.vcenter.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_VCENTER_PORT}"
      - "${MEDIATION_VCENTER_DEBUG_PORT}"
    environment:
      component_type: mediation-vcenter
      instance_id: mediation-vcenter-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_VCENTER_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_VCENTER_MEM_LIMIT_MB}M

  mediation-vcenter-browsing:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.vcenter.browsing.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_VCENTER_BROWSING_PORT}"
      - "${MEDIATION_VCENTER_BROWSING_DEBUG_PORT}"
    environment:
      component_type: mediation-vcenter-browsing
      instance_id: mediation-vcenter-browsing-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_VCENTER_BROWSING_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_VCENTER_BROWSING_MEM_LIMIT_MB}M

  mediation-stressprobe:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.stressprobe.component:${XL_VERSION}
    ports:
      - "${MEDIATION_STRESSPROBE_PORT}"
      - "${MEDIATION_STRESSPROBE_DEBUG_PORT}"
    depends_on: *clustermgrdep
    environment:
      component_type: mediation-stressprobe
      instance_id: mediation-stressprobe-1
      serverHttpPort: 8080
      serverGrpcPort: 9001
      consul_host: consul
      consul_port: 8500
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_STRESSPROBE_SYSTEM_PROPERTIES}"
      kvStoreRetryIntervalMillis : 1000
    mem_limit: ${MEDIATION_STRESSPROBE_MEM_LIMIT_MB}M

  mediation-storagestressprobe:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.storagestressprobe.component:${XL_VERSION}
    ports:
      - "${MEDIATION_STORAGESTRESSPROBE_PORT}"
      - "${MEDIATION_STORAGESTRESSPROBE_DEBUG_PORT}"
    depends_on: *clustermgrdep
    environment:
      serverHttpPort: 8080
      serverGrpcPort: 9001
      consul_host: consul
      consul_port: 8500
      component_type: mediation-stressprobe
      instance_id: mediation-storagestressprobe-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_STORAGESTRESSPROBE_SYSTEM_PROPERTIES}"
      kvStoreRetryIntervalMillis : 1000
    mem_limit: ${MEDIATION_STORAGESTRESSPROBE_MEM_LIMIT_MB}M

  mediation-delegatingprobe:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.delegatingprobe.component:${XL_VERSION}
    ports:
      - "${MEDIATION_DELEGATINGPROBE_PORT}"
      - "${MEDIATION_DELEGATINGPROBE_DEBUG_PORT}"
    depends_on: *clustermgrdep
    environment:
      component_type: mediation-delegatingprobe
      instance_id: mediation-delegatingprobe-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_DELEGATINGPROBE_SYSTEM_PROPERTIES}"
      kvStoreRetryIntervalMillis : 1000
    mem_limit: ${MEDIATION_DELEGATINGPROBE_MEM_LIMIT_MB}M

  mediation-hyperv:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.hyperv.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_HYPERV_PORT}"
      - "${MEDIATION_HYPERV_DEBUG_PORT}"
    environment:
      component_type: mediation-hyperv
      instance_id: mediation-hyperv-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_HYPERV_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_HYPERV_MEM_LIMIT_MB}M

  mediation-netapp:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.netapp.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_NETAPP_PORT}"
      - "${MEDIATION_NETAPP_DEBUG_PORT}"
    environment:
      component_type: mediation-netapp
      instance_id: mediation-netapp-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_NETAPP_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_NETAPP_MEM_LIMIT_MB}M

  mediation-ucs:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.ucs.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_UCS_PORT}"
      - "${MEDIATION_UCS_DEBUG_PORT}"
    environment:
      component_type: mediation-ucs
      instance_id: mediation-ucs-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_UCS_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_UCS_MEM_LIMIT_MB}M

  mediation-aix:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.aix.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_AIX_PORT}"
      - "${MEDIATION_AIX_DEBUG_PORT}"
    environment:
      component_type: mediation-aix
      instance_id: mediation-aix-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_AIX_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_AIX_MEM_LIMIT_MB}M

  mediation-vmax:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.vmax.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_VMAX_PORT}"
      - "${MEDIATION_VMAX_DEBUG_PORT}"
    environment:
      component_type: mediation-vmax
      instance_id: mediation-vmax-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_VMAX_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_VMAX_MEM_LIMIT_MB}M

  mediation-vmm:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.vmm.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_VMM_PORT}"
      - "${MEDIATION_VMM_DEBUG_PORT}"
    environment:
      component_type: mediation-vmm
      instance_id: mediation-vmm-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_VMM_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_VMM_MEM_LIMIT_MB}M

  mediation-hpe3par:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.hpe3par.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_HPE3PAR_PORT}"
      - "${MEDIATION_HPE3PAR_DEBUG_PORT}"
    environment:
      component_type: mediation-hpe3par
      instance_id: mediation-hpe3par-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_HPE3PAR_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_HPE3PAR_MEM_LIMIT_MB}M

  mediation-pure:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.pure.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_PURE_PORT}"
      - "${MEDIATION_PURE_DEBUG_PORT}"
    environment:
      component_type: mediation-pure
      instance_id: mediation-pure-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_PURE_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_PURE_MEM_LIMIT_MB}M

  mediation-scaleio:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.scaleio.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_SCALEIO_PORT}"
      - "${MEDIATION_SCALEIO_DEBUG_PORT}"
    environment:
      component_type: mediation-scaleio
      instance_id: mediation-scaleio-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_SCALEIO_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_SCALEIO_MEM_LIMIT_MB}M

  mediation-hds:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.hds.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_HDS_PORT}"
      - "${MEDIATION_HDS_DEBUG_PORT}"
    environment:
      component_type: mediation-hds
      instance_id: mediation-hds-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_HDS_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_HDS_MEM_LIMIT_MB}M

  mediation-compellent:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.compellent.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_COMPELLENT_PORT}"
      - "${MEDIATION_COMPELLENT_DEBUG_PORT}"
    environment:
      component_type: mediation-compellent
      instance_id: mediation-compellent-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_COMPELLENT_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_COMPELLENT_MEM_LIMIT_MB}M

  mediation-xtremio:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.xtremio.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_XTREMIO_PORT}"
      - "${MEDIATION_XTREMIO_DEBUG_PORT}"
    environment:
      component_type: mediation-xtremio
      instance_id: mediation-xtremio-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_XTREMIO_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_XTREMIO_MEM_LIMIT_MB}M

  mediation-vplex:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.vplex.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_VPLEX_PORT}"
      - "${MEDIATION_VPLEX_DEBUG_PORT}"
    environment:
      component_type: mediation-vplex
      instance_id: mediation-vplex-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_VPLEX_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_VPLEX_MEM_LIMIT_MB}M

  mediation-rhv:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.rhv.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_RHV_PORT}"
      - "${MEDIATION_RHV_DEBUG_PORT}"
    environment:
      component_type: mediation-rhv
      instance_id: mediation-rhv-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_RHV_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_RHV_MEM_LIMIT_MB}M

  mediation-openstack:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.openstack.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_OPENSTACK_PORT}"
      - "${MEDIATION_OPENSTACK_DEBUG_PORT}"
    environment:
      component_type: mediation-openstack
      instance_id: mediation-openstack-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_OPENSTACK_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_OPENSTACK_MEM_LIMIT_MB}M

  mediation-ucsdirector:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.ucsdirector.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_UCSDIRECTOR_PORT}"
      - "${MEDIATION_UCSDIRECTOR_DEBUG_PORT}"
    environment:
      component_type: mediation-ucsdirector
      instance_id: mediation-ucsdirector-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_UCSDIRECTOR_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_UCSDIRECTOR_MEM_LIMIT_MB}M

  mediation-aws:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.aws.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_AWS_PORT}"
      - "${MEDIATION_AWS_DEBUG_PORT}"
    environment:
      component_type: mediation-aws
      instance_id: mediation-aws-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_AWS_SYSTEM_PROPERTIES}"
      # overriding the tmpdir location because the cloud probes download large files to temp, and we
      # don't want these to go to a memory-backed volume like /tmp
      MORE_JAVA_OPTS: -Djava.io.tmpdir=/home/turbonomic/data
    volumes:
      - mediation-aws:/home/turbonomic/data
    mem_limit: ${MEDIATION_AWS_MEM_LIMIT_MB}M

  mediation-awsbilling:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.aws.billing.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_AWSBILLING_PORT}"
      - "${MEDIATION_AWSBILLING_DEBUG_PORT}"
    environment:
      component_type: mediation-awsbilling
      instance_id: mediation-awsbilling-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_AWSBILLING_SYSTEM_PROPERTIES}"
      # overriding the tmpdir location because the cloud probes download large files to temp, and we
      # don't want these to go to a memory-backed volume like /tmp
      MORE_JAVA_OPTS: -Djava.io.tmpdir=/home/turbonomic/data
    volumes:
      - mediation-awsbilling:/home/turbonomic/data
    mem_limit: ${MEDIATION_AWSBILLING_MEM_LIMIT_MB}M

  mediation-awscost:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.aws.cost.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_AWSCOST_PORT}"
      - "${MEDIATION_AWSCOST_DEBUG_PORT}"
    environment:
      component_type: mediation-awscost
      instance_id: mediation-awscost-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_AWSCOST_SYSTEM_PROPERTIES}"
      # overriding the tmpdir location because the cloud probes download large files to temp, and we
      # don't want these to go to a memory-backed volume like /tmp
      MORE_JAVA_OPTS: -Djava.io.tmpdir=/home/turbonomic/data
    volumes:
      - mediation-awscost:/home/turbonomic/data
    mem_limit: ${MEDIATION_AWSCOST_MEM_LIMIT_MB}M

  mediation-datadog:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.datadog.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_DATADOG_PORT}"
      - "${MEDIATION_DATADOG_DEBUG_PORT}"
    environment:
      component_type: mediation-datadog
      instance_id: mediation-datadog-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} -Xmx${MEDIATION_DATADOG_XMX_MB}M ${MEDIATION_DATADOG_SYSTEM_PROPERTIES}"
      # overriding the tmpdir location because the cloud probes download large files to temp, and we
      # don't want these to go to a memory-backed volume like /tmp
      MORE_JAVA_OPTS: -Djava.io.tmpdir=/home/turbonomic/data
    volumes:
      - mediation-datadog:/home/turbonomic/data
    mem_limit: ${MEDIATION_DATADOG_MEM_LIMIT_MB}M

  mediation-azure:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.azure.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_AZURE_PORT}"
      - "${MEDIATION_AZURE_DEBUG_PORT}"
    environment:
      component_type: mediation-azure
      instance_id: mediation-azure-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_AZURE_SYSTEM_PROPERTIES}"
      # overriding the tmpdir location because the cloud probes download large files to temp, and we
      # don't want these to go to a memory-backed volume like /tmp
      MORE_JAVA_OPTS: -Djava.io.tmpdir=/home/turbonomic/data
    volumes:
      - mediation-azure:/home/turbonomic/data
    mem_limit: ${MEDIATION_AZURE_MEM_LIMIT_MB}M

  mediation-azurecost:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.azure.cost.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_AZURECOST_PORT}"
      - "${MEDIATION_AZURECOST_DEBUG_PORT}"
    environment:
      component_type: mediation-azurecost
      instance_id: mediation-azurecost-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_AZURECOST_SYSTEM_PROPERTIES}"
      # overriding the tmpdir location because the cloud probes download large files to temp, and we
      # don't want these to go to a memory-backed volume like /tmp
      MORE_JAVA_OPTS: -Djava.io.tmpdir=/home/turbonomic/data
    volumes:
      - mediation-azurecost:/home/turbonomic/data
    mem_limit: ${MEDIATION_AZURECOST_MEM_LIMIT_MB}M

  mediation-azure-volumes:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.azure.volumes.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_AZURE_VOLUMES_PORT}"
      - "${MEDIATION_AZURE_VOLUMES_DEBUG_PORT}"
    environment:
      component_type: mediation-azure-volumes
      instance_id: mediation-azure-volumes-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_AZURE_VOLUMES_SYSTEM_PROPERTIES}"
      # overriding the tmpdir location because the cloud probes download large files to temp, and we
      # don't want these to go to a memory-backed volume like /tmp
      MORE_JAVA_OPTS: -Djava.io.tmpdir=/home/turbonomic/data
    mem_limit: ${MEDIATION_AZURE_VOLUMES_MEM_LIMIT_MB}M

  mediation-oneview:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.oneview.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_ONEVIEW_PORT}"
      - "${MEDIATION_ONEVIEW_DEBUG_PORT}"
    environment:
      component_type: mediation-oneview
      instance_id: mediation-oneview-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_ONEVIEW_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_ONEVIEW_MEM_LIMIT_MB}M

  mediation-vcd:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.vcd.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_VCD_PORT}"
      - "${MEDIATION_VCD_DEBUG_PORT}"
    environment:
      component_type: mediation-vcd
      instance_id: mediation-vcd-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_VCD_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_VCD_MEM_LIMIT_MB}M

  mediation-mssql:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.database.mssql.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_MSSQL_PORT}"
      - "${MEDIATION_MSSQL_DEBUG_PORT}"
    environment:
      component_type: mediation-mssql
      instance_id: mediation-mssql-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_MSSQL_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_MSSQL_MEM_LIMIT_MB}M

  mediation-actionscript:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.actionscript.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_ACTIONSCRIPT_PORT}"
      - "${MEDIATION_ACTIONSCRIPT_DEBUG_PORT}"
    environment:
      component_type: mediation-actionscript
      instance_id: mediation-actionscript-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_ACTIONSCRIPT_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_ACTIONSCRIPT_MEM_LIMIT_MB}M

  mediation-wmi:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.apm.wmi.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_WMI_PORT}"
      - "${MEDIATION_WMI_DEBUG_PORT}"
    environment:
      component_type: mediation-wmi
      instance_id: mediation-wmi-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_WMI_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_WMI_MEM_LIMIT_MB}M

  mediation-snmp:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.apm.snmp.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_SNMP_PORT}"
      - "${MEDIATION_SNMP_DEBUG_PORT}"
    environment:
      component_type: mediation-snmp
      instance_id: mediation-snmp-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_SNMP_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_SNMP_MEM_LIMIT_MB}M

  mediation-appdynamics:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.appdynamics.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_APPDYNAMICS_PORT}"
      - "${MEDIATION_APPDYNAMICS_DEBUG_PORT}"
    environment:
      component_type: mediation-appdynamics
      instance_id: mediation-appdynamics-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_APPDYNAMICS_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_APPDYNAMICS_MEM_LIMIT_MB}M

  mediation-dynatrace:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.dynatrace.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_DYNATRACE_PORT}"
      - "${MEDIATION_DYNATRACE_DEBUG_PORT}"
    environment:
      component_type: mediation-dynatrace
      instance_id: mediation-dynatrace-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_DYNATRACE_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_DYNATRACE_MEM_LIMIT_MB}M

  mediation-pivotal:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.pivotal.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_PIVOTAL_PORT}"
      - "${MEDIATION_PIVOTAL_DEBUG_PORT}"
    environment:
      component_type: mediation-pivotal
      instance_id: mediation-pivotal-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_PIVOTAL_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_PIVOTAL_MEM_LIMIT_MB}M

  mediation-cloudfoundry:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.cloudfoundry.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_CLOUDFOUNDRY_PORT}"
      - "${MEDIATION_CLOUDFOUNDRY_DEBUG_PORT}"
    environment:
      component_type: mediation-cloudfoundry
      instance_id: mediation-cloudfoundry-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_CLOUDFOUNDRY_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_CLOUDFOUNDRY_MEM_LIMIT_MB}M

  mediation-istio:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.istio.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_ISTIO_PORT}"
      - "${MEDIATION_ISTIO_DEBUG_PORT}"
    environment:
      component_type: mediation-istio
      instance_id: mediation-istio-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_ISTIO_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_ISTIO_MEM_LIMIT_MB}M

  mediation-netflow:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.netflow.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_NETFLOW_PORT}"
      - "${MEDIATION_NETFLOW_DEBUG_PORT}"
    environment:
      component_type: mediation-netflow
      instance_id: mediation-netflow-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_NETFLOW_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_NETFLOW_MEM_LIMIT_MB}M

  mediation-tetration:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.tetration.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_TETRATION_PORT}"
      - "${MEDIATION_TETRATION_DEBUG_PORT}"
    environment:
      component_type: mediation-tetration
      instance_id: mediation-tetration-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_TETRATION_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_TETRATION_MEM_LIMIT_MB}M

  mediation-hyperflex:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.hyperflex.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
      - "${MEDIATION_HYPERFLEX_PORT}"
      - "${MEDIATION_HYPERFLEX_DEBUG_PORT}"
    environment:
      component_type: mediation-hyperflex
      instance_id: mediation-hyperflex-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_HYPERFLEX_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_HYPERFLEX_MEM_LIMIT_MB}M

  mediation-horizon:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/com.vmturbo.mediation.horizon.component:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
    - "${MEDIATION_HORIZON_PORT}"
    - "${MEDIATION_HORIZON_DEBUG_PORT}"
    environment:
      component_type: mediation-horizon
      instance_id: mediation-horizon-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_HORIZON_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_HORIZON_MEM_LIMIT_MB}M

  mediation:
    extends:
      file: common-services.yml
      service: dev-mediation-component
    image: turbonomic/mediation:${XL_VERSION}
    depends_on: *clustermgrdep
    ports:
    - "${MEDIATION_COMPONENT_PORT}"
    - "${MEDIATION_COMPONENT_DEBUG_PORT}"
    environment:
      component_type: mediation
      instance_id: mediation-1
      JAVA_OPTS: "${DEV_JAVA_OPTS} ${MEDIATION_COMPONENT_SYSTEM_PROPERTIES}"
    mem_limit: ${MEDIATION_COMPONENT_MEM_LIMIT_MB}M
