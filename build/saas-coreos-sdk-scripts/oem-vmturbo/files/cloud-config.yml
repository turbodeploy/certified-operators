#cloud-config

coreos:
  units:
    - name: remote-mediation-activation.service
      command: start
      runtime: true
      content: |
        [Unit]
        Description=VMTurbo remote-mediation activation
        After=docker.service
        
        [Service]
        TimeoutStartSec=0
        ExecStartPre=-/usr/bin/docker kill remote-mediation-activation
        ExecStartPre=-/usr/bin/docker rm remote-mediation-activation
        ExecStartPre=/usr/bin/docker pull vmturbo/remote-mediation-activation
        ExecStart=/usr/bin/docker run -v /var/run/docker.sock:/var/run/docker.sock -v /usr/bin/docker:/usr/bin/docker -v /usr/lib/libdevmapper.so.1.02:/usr/lib/libdevmapper.so.1.02 -p 80:8080 --name remote-mediation-activation vmturbo/remote-mediation-activation
        ExecStop=/usr/bin/docker stop remote-mediation-activation
        
        [Install]
        WantedBy=multi-user.target

  oem:
    id: vmturbo
    name: VMTurbo
    version-id: @@OEM_VERSION_ID@@
    home-url: http://vmturbo.com
    bug-report-url: https://github.com/coreos/coreos-overlay

users:
    - name: "vmturbo"
      passwd: "$1$WZ2VDAGH$vh/zTxspP6AzqMVNy8osf0"
      groups:
        - "sudo"
        - "docker"

