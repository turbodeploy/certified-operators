---
annotations:
  list:
  - builtIn: 1
    datasource: -- Grafana --
    enable: true
    hide: true
    iconColor: rgba(0, 211, 255, 1)
    name: Annotations & Alerts
    type: dashboard
editable: false
gnetId:
graphTooltip: 1
iteration: 1613758561580
links: []
panels:
- aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  datasource: $DB
  fieldConfig:
    defaults:
      custom: {}
    overrides: []
  fill: 0
  fillGradient: 0
  gridPos:
    h: 10
    w: 24
    x: 0
    y: 0
  hiddenSeries: false
  id: 5
  legend:
    avg: false
    current: false
    max: false
    min: false
    show: true
    total: false
    values: false
  lines: true
  linewidth: 3
  nullPointMode: 'null'
  percentage: false
  pluginVersion: 7.1.1
  pointradius: 2
  points: false
  renderer: flot
  seriesOverrides:
  - alias: Daily Error
    bars: true
    lines: false
  spaceLength: 10
  stack: false
  steppedLine: false
  targets:
  - format: time_series
    group: []
    metricColumn: none
    rawQuery: true
    rawSql: |-
      SELECT day as time
            ,error as "Daily Error"
            ,AVG(error) OVER (ORDER BY day ROWS BETWEEN $ma_days - 1 PRECEDING AND CURRENT ROW) as "Moving Error"
      FROM
           (SELECT DATE_TRUNC('hour', time) as day
                  ,SUM(CASE WHEN current - capacity*$desired_factor > 0
                            THEN current - capacity*$desired_factor
                            ELSE 0
                       END) / SUM((1-$desired_factor)*capacity) as error
              FROM metric
             WHERE type = ${metric_type:singlequote}
               AND $__timeFilter(time)
               AND consumed is NULL
             GROUP BY 1) as data;
    refId: A
    select:
    - - params:
        - savings
        type: column
    table: action_spec
    timeColumn: first_seen
    timeColumnType: timestamp
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom:
  timeRegions: []
  timeShift:
  title: Environment Out of Compliance
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets:
    mode: time
    name:
    show: true
    values: []
  yaxes:
  - format: percentunit
    label:
    logBase: 1
    max:
    min:
    show: true
  - format: none
    label:
    logBase: 1
    max:
    min:
    show: true
  yaxis:
    align: false
    alignLevel:
- aliasColors: {}
  bars: true
  dashLength: 10
  dashes: false
  datasource: $DB
  fieldConfig:
    defaults:
      custom: {}
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 8
    w: 24
    x: 0
    y: 10
  hiddenSeries: false
  id: 10
  legend:
    avg: false
    current: false
    max: false
    min: false
    show: true
    total: false
    values: false
  lines: false
  linewidth: 1
  nullPointMode: 'null'
  percentage: false
  pluginVersion: 7.1.1
  pointradius: 2
  points: false
  renderer: flot
  seriesOverrides:
  - alias: Successful
    color: '#56A64B'
  - alias: Failed
    color: '#FF780A'
  spaceLength: 10
  stack: true
  steppedLine: false
  targets:
  - format: time_series
    group: []
    metricColumn: none
    rawQuery: true
    rawSql: |-
      SELECT DATE_TRUNC('hour', completion_time) as time
            ,count(DISTINCT action_oid) FILTER (where final_state = 'FAILED') as "Failed"
            ,count(DISTINCT action_oid) FILTER (where final_state = 'SUCCEEDED') as "Successful"
        FROM completed_action
       WHERE $__timeFilter(completion_time)
         AND final_state in ('SUCCEEDED', 'FAILED')
      GROUP BY 1
    refId: A
    select:
    - - params:
        - value
        type: column
    timeColumn: time
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom:
  timeRegions: []
  timeShift:
  title: Actions by State per Hour
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets:
    mode: time
    name:
    show: true
    values: []
  yaxes:
  - format: none
    label:
    logBase: 1
    max:
    min:
    show: true
  - format: short
    label:
    logBase: 1
    max:
    min:
    show: true
  yaxis:
    align: false
    alignLevel:
- aliasColors: {}
  bars: true
  dashLength: 10
  dashes: false
  datasource: $DB
  fieldConfig:
    defaults:
      custom: {}
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 8
    w: 24
    x: 0
    y: 18
  hiddenSeries: false
  id: 4
  legend:
    avg: false
    current: false
    max: false
    min: false
    show: true
    total: false
    values: false
  lines: false
  linewidth: 1
  nullPointMode: 'null'
  percentage: false
  pluginVersion: 7.1.1
  pointradius: 2
  points: false
  renderer: flot
  seriesOverrides: []
  spaceLength: 10
  stack: true
  steppedLine: false
  targets:
  - format: time_series
    group: []
    metricColumn: none
    rawQuery: true
    rawSql: |-
      SELECT DATE_TRUNC('hour', completion_time) as time
            ,count(DISTINCT action_oid) FILTER (where type = 'MOVE') as "MOVE"
            ,count(DISTINCT action_oid) FILTER (where type = 'PROVISION') as "PROVISION"
            ,count(DISTINCT action_oid) FILTER (where type = 'RESIZE') as "RESIZE"
            ,count(DISTINCT action_oid) FILTER (where type = 'DEACTIVATE') as "DEACTIVATE"
        FROM completed_action
       WHERE $__timeFilter(completion_time)
         AND final_state = 'SUCCEEDED'
       GROUP BY 1
    refId: A
    select:
    - - params:
        - value
        type: column
    timeColumn: time
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom:
  timeRegions: []
  timeShift:
  title: Successful Actions by Type per Hour
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets:
    mode: time
    name:
    show: true
    values: []
  yaxes:
  - format: short
    label:
    logBase: 1
    max:
    min:
    show: true
  - format: short
    label:
    logBase: 1
    max:
    min:
    show: true
  yaxis:
    align: false
    alignLevel:
schemaVersion: 26
style: dark
tags: []
templating:
  list:
  - hide: 2
    includeAll: false
    label:
    multi: false
    name: DB
    options: []
    query: postgres
    queryValue: ''
    refresh: 1
    regex: ''
    skipUrlSync: false
    type: datasource
  - allValue:
    datasource: $DB
    definition: SELECT unnest(enum_range(NULL::metric_type))
    hide: 0
    includeAll: false
    label: Metric Type
    multi: false
    name: metric_type
    options: []
    query: SELECT unnest(enum_range(NULL::metric_type))
    refresh: 2
    regex: ''
    skipUrlSync: false
    sort: 0
    tagValuesQuery: ''
    tags: []
    tagsQuery: ''
    type: query
    useTags: false
  - allValue:
    datasource: $DB
    definition: SELECT generate_series || '%' as __text, generate_series*.01 as __value
      FROM generate_series(10,100,10)
    hide: 0
    includeAll: false
    label: Target Utilization
    multi: false
    name: desired_factor
    options: []
    query: SELECT generate_series || '%' as __text, generate_series*.01 as __value
      FROM generate_series(10,100,10)
    refresh: 2
    regex: ''
    skipUrlSync: false
    sort: 0
    tagValuesQuery: ''
    tags: []
    tagsQuery: ''
    type: query
    useTags: false
  - allValue:
    current:
      selected: true
      text: '24'
      value: '24'
    hide: 0
    includeAll: false
    label: Moving Avg Hours
    multi: false
    name: ma_days
    options:
    - selected: false
      text: '3'
      value: '3'
    - selected: false
      text: '12'
      value: '12'
    - selected: true
      text: '24'
      value: '24'
    - selected: false
      text: '72'
      value: '72'
    query: 3,12,24,72
    queryValue: ''
    skipUrlSync: false
    type: custom
time:
  from: now-7d
  to: now
timepicker:
  refresh_intervals:
  - 10s
  - 30s
  - 1m
  - 5m
  - 15m
  - 30m
  - 1h
  - 2h
  - 1d
timezone: ''
title: SLO Hourly Violations Dashboard
uid: slo_hourly_violations
