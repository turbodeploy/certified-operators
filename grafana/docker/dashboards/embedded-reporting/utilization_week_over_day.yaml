---
__inputs: []
__requires:
- type: grafana
  id: grafana
  name: Grafana
  version: 8.0.6
- type: panel
  id: graph
  name: Graph (old)
  version: ""
- type: datasource
  id: postgres
  name: PostgreSQL
  version: 1.0.0
annotations:
  list:
  - builtIn: 1
    datasource: -- Grafana --
    enable: true
    hide: true
    iconColor: rgba(0, 211, 255, 1)
    name: Annotations & Alerts
    type: dashboard
description: This dashboard compares average daily utilization measurements for physical
  machines (aka hosts) week-over-week for two consecutive weeks. All physical machines
  in the selected group are included in the averages.
editable: false
gnetId: null
graphTooltip: 1
iteration: 1627069804249
links: []
panels:
- aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  datasource: $DB
  decimals: 2
  description: Average memory utilization for physical machines
  fieldConfig:
    defaults:
      links: []
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 11
    w: 12
    x: 0
    y: 0
  hiddenSeries: false
  id: 4
  interval: ""
  legend:
    alignAsTable: true
    avg: true
    current: false
    hideEmpty: false
    hideZero: false
    max: false
    min: false
    rightSide: false
    show: true
    total: false
    values: true
  lines: true
  linewidth: 2
  nullPointMode: "null"
  options:
    alertThreshold: true
  percentage: false
  pluginVersion: 8.0.6
  pointradius: 2
  points: true
  renderer: flot
  seriesOverrides:
  - $$hashKey: object:5515
    alias: Previous Week
    color: rgba(232, 0, 6, 0.5)
    dashes: true
    fill: 0
  - $$hashKey: object:5533
    alias: /Week Ending/
    color: '#56A64B'
  spaceLength: 10
  stack: false
  steppedLine: false
  targets:
  - format: time_series
    group: []
    hide: false
    metricColumn: none
    rawQuery: true
    rawSql: |-
      WITH metrics AS (
        SELECT m.time, m.utilization
          FROM metric m,
          scope_to($__timeFrom()::timestamptz - INTERVAL '7 day', $__timeTo(), 'PHYSICAL_MACHINE', ARRAY[${Group}]::bigint[], '${Group:raw}' = '0') s
          WHERE
            m.entity_oid = s.oid
            AND m.time BETWEEN s.from_time AND s.to_time
            AND m.type = 'MEM'
            AND m.time BETWEEN ($__timeFrom()::TIMESTAMPTZ - interval '7 day') AND date_trunc('day', $__timeTo()::TIMESTAMPTZ)
          GROUP BY m.time, m.entity_oid, m.utilization
      ),
      DATA AS (
        SELECT m.time, avg(m.utilization) AS avg_util
        FROM metrics m
        GROUP BY m.time
      )
      SELECT
        INTERVAL '1 DAY' + CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN date_trunc('day', time + interval '7 day')
          ELSE date_trunc('day', time)
        END as "time",
        CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN 'Previous Week'
          ELSE 'Week Ending ' || DATE($__timeTo()::TIMESTAMPTZ)::TEXT
        END as metric,
        avg(avg_util)
      FROM data
      GROUP BY 1, 2
      ORDER BY 1, 2
    refId: A
    select:
    - - params:
        - current
        type: column
    table: metric
    timeColumn: '"time"'
    timeColumnType: timestamp
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom: null
  timeRegions: []
  timeShift: null
  title: Physical Machine Avg Memory Utilization - Week over Week by Day
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets: null
    mode: time
    name: null
    show: true
    values: []
  yaxes:
  - $$hashKey: object:83
    format: percentunit
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  - $$hashKey: object:84
    format: short
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  yaxis:
    align: false
    alignLevel: null
- aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  datasource: $DB
  decimals: 2
  description: Average CPU utilization by physical machine
  fieldConfig:
    defaults:
      links: []
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 11
    w: 12
    x: 12
    y: 0
  hiddenSeries: false
  id: 6
  legend:
    alignAsTable: true
    avg: true
    current: false
    max: false
    min: false
    rightSide: false
    show: true
    total: false
    values: true
  lines: true
  linewidth: 2
  nullPointMode: "null"
  options:
    alertThreshold: true
  percentage: false
  pluginVersion: 8.0.6
  pointradius: 2
  points: true
  renderer: flot
  seriesOverrides:
  - $$hashKey: object:5578
    alias: Previous Week
    color: rgba(232, 0, 6, 0.5)
    dashes: true
    fill: 0
  - $$hashKey: object:5596
    alias: /Week Ending/
    color: '#56A64B'
  spaceLength: 10
  stack: false
  steppedLine: false
  targets:
  - format: time_series
    group: []
    metricColumn: none
    rawQuery: true
    rawSql: |-
      WITH metrics AS (
        SELECT m.time, m.utilization
        FROM metric m,
          scope_to($__timeFrom()::timestamptz - INTERVAL '7 day', $__timeTo(), 'PHYSICAL_MACHINE', ARRAY[${Group}]::bigint[], '${Group:raw}' = '0') s
        WHERE
          m.entity_oid = s.oid AND m.time BETWEEN s.from_time AND s.to_time
          AND m.type = 'CPU'
          AND m.time BETWEEN ($__timeFrom()::TIMESTAMPTZ - interval '7 day') AND date_trunc('day', $__timeTo()::TIMESTAMPTZ)
        GROUP BY m.time, m.entity_oid, m.utilization
      ),
      DATA AS (
        SELECT
          m.time,
          avg(m.utilization) AS avg_util
        FROM metrics m
        GROUP BY m.time
      )
      SELECT
        INTERVAL '1 DAY' + CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN date_trunc('day', time + interval '7 day')
            ELSE date_trunc('day', time)
        END as "time",
        CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN 'Previous Week'
          ELSE 'Week Ending ' || DATE($__timeTo()::TIMESTAMPTZ)::TEXT
        END as metric,
        avg(avg_util)
      FROM data
      GROUP BY 1, 2
      ORDER BY 1, 2
    refId: A
    select:
    - - params:
        - current
        type: column
    table: metric
    timeColumn: '"time"'
    timeColumnType: timestamp
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom: null
  timeRegions: []
  timeShift: null
  title: Physical Machine Avg CPU Utilization - Week over Week by Day
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets: null
    mode: time
    name: null
    show: true
    values: []
  yaxes:
  - $$hashKey: object:167
    format: percentunit
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  - $$hashKey: object:168
    format: short
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  yaxis:
    align: false
    alignLevel: null
- aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  datasource: $DB
  decimals: 2
  description: Average Ballooning utilization by physical machines
  fieldConfig:
    defaults:
      links: []
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 10
    w: 12
    x: 0
    y: 11
  hiddenSeries: false
  id: 10
  legend:
    alignAsTable: true
    avg: true
    current: false
    max: false
    min: false
    rightSide: false
    show: true
    total: false
    values: true
  lines: true
  linewidth: 2
  nullPointMode: "null"
  options:
    alertThreshold: true
  percentage: false
  pluginVersion: 8.0.6
  pointradius: 2
  points: true
  renderer: flot
  seriesOverrides:
  - $$hashKey: object:5643
    alias: Previous Week
    color: rgba(232, 0, 6, 0.5)
    dashes: true
    fill: 0
  - $$hashKey: object:5661
    alias: /Week Ending/
    color: '#56A64B'
  spaceLength: 10
  stack: false
  steppedLine: false
  targets:
  - format: time_series
    group: []
    hide: false
    metricColumn: none
    rawQuery: true
    rawSql: |-
      WITH metrics AS (
        SELECT m.time, m.utilization
        FROM metric m,
          scope_to($__timeFrom()::timestamptz - INTERVAL '7 day', $__timeTo(), 'PHYSICAL_MACHINE', ARRAY[${Group}]::bigint[], '${Group:raw}' = '0') s
        WHERE
          m.entity_oid = s.oid
          AND m.time BETWEEN s.from_time AND s.to_time
          AND m.type = 'BALLOONING'
          AND m.time BETWEEN ($__timeFrom()::TIMESTAMPTZ - interval '7 day') AND date_trunc('day', $__timeTo()::TIMESTAMPTZ)
        GROUP BY m.time, m.entity_oid, m.utilization
      ),
      DATA AS (
        SELECT
          m.time,
          avg(m.utilization) AS avg_util
        FROM metrics m
        GROUP BY m.time
      )
      SELECT
        INTERVAL '1 DAY' + CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN date_trunc('day', time + interval '7 day')
          ELSE date_trunc('day', time)
        END as "time",
        CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN 'Previous Week'
          ELSE 'Week Ending ' || DATE($__timeTo()::TIMESTAMPTZ)::TEXT
        END as metric,
        avg(avg_util)
      FROM data
      GROUP BY 1, 2
      ORDER BY 1, 2
    refId: A
    select:
    - - params:
        - current
        type: column
    table: metric
    timeColumn: '"time"'
    timeColumnType: timestamp
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom: null
  timeRegions: []
  timeShift: null
  title: Physical Machine Avg Ballooning Utilization - Week over Week by Day
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets: null
    mode: time
    name: null
    show: true
    values: []
  yaxes:
  - $$hashKey: object:335
    format: percentunit
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  - $$hashKey: object:336
    format: short
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  yaxis:
    align: false
    alignLevel: null
- aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  datasource: $DB
  decimals: 2
  description: Average Swapping utilization by physical machines
  fieldConfig:
    defaults:
      links: []
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 10
    w: 12
    x: 12
    y: 11
  hiddenSeries: false
  id: 8
  legend:
    alignAsTable: true
    avg: true
    current: false
    max: false
    min: false
    rightSide: false
    show: true
    total: false
    values: true
  lines: true
  linewidth: 2
  nullPointMode: "null"
  options:
    alertThreshold: true
  percentage: false
  pluginVersion: 8.0.6
  pointradius: 2
  points: true
  renderer: flot
  seriesOverrides:
  - $$hashKey: object:5707
    alias: Previous Week
    color: rgba(232, 0, 6, 0.5)
    dashes: true
    fill: 0
  - $$hashKey: object:5725
    alias: /Week Ending/
    color: '#56A64B'
  spaceLength: 10
  stack: false
  steppedLine: false
  targets:
  - format: time_series
    group: []
    metricColumn: none
    rawQuery: true
    rawSql: |-
      WITH metrics AS (
        SELECT m.time, m.utilization
        FROM metric m,
          scope_to($__timeFrom()::timestamptz - INTERVAL '7 day', $__timeTo(), 'PHYSICAL_MACHINE', ARRAY[${Group}]::bigint[], '${Group:raw}' = '0') s
        WHERE
          m.entity_oid = s.oid
          AND m.type = 'SWAPPING'
          AND m.time BETWEEN ($__timeFrom()::TIMESTAMPTZ - interval '7 day') AND date_trunc('day', $__timeTo()::TIMESTAMPTZ)
        GROUP BY m.time, m.entity_oid, m.utilization
      ),
      DATA AS (
        SELECT
          m.time,
          avg(m.utilization) AS avg_util
        FROM metrics m
        GROUP BY m.time
      )
      SELECT
        INTERVAL '1 DAY' + CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN date_trunc('day', time + interval '7 day')
          ELSE date_trunc('day', time)
        END as "time",
        CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN 'Previous Week'
          ELSE 'Week Ending ' || DATE($__timeTo()::TIMESTAMPTZ)::TEXT
        END as metric,
        avg(avg_util)
      FROM data
      GROUP BY 1, 2
      ORDER BY 1, 2
    refId: A
    select:
    - - params:
        - current
        type: column
    table: metric
    timeColumn: '"time"'
    timeColumnType: timestamp
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom: null
  timeRegions: []
  timeShift: null
  title: Physical Machine Avg Swapping Utilization - Week over Week by Day
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets: null
    mode: time
    name: null
    show: true
    values: []
  yaxes:
  - $$hashKey: object:251
    format: percentunit
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  - $$hashKey: object:252
    format: short
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  yaxis:
    align: false
    alignLevel: null
- aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  datasource: $DB
  decimals: 2
  description: Average IO Throughput utilization by physical machine
  fieldConfig:
    defaults:
      links: []
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 10
    w: 12
    x: 0
    y: 21
  hiddenSeries: false
  id: 12
  legend:
    alignAsTable: true
    avg: true
    current: false
    max: false
    min: false
    rightSide: false
    show: true
    total: false
    values: true
  lines: true
  linewidth: 2
  nullPointMode: "null"
  options:
    alertThreshold: true
  percentage: false
  pluginVersion: 8.0.6
  pointradius: 2
  points: true
  renderer: flot
  seriesOverrides:
  - $$hashKey: object:5771
    alias: Previous Week
    color: rgba(232, 0, 6, 0.5)
    dashes: true
    fill: 0
  - $$hashKey: object:5789
    alias: /Week Ending/
    color: '#56A64B'
  spaceLength: 10
  stack: false
  steppedLine: false
  targets:
  - format: time_series
    group: []
    metricColumn: none
    rawQuery: true
    rawSql: |-
      WITH metrics AS (
        SELECT m.time, m.utilization
        FROM metric m,
          scope_to($__timeFrom()::timestamptz - INTERVAL '7 day', $__timeTo(), 'PHYSICAL_MACHINE', ARRAY[${Group}]::bigint[], '${Group:raw}' = '0') s
        WHERE
          m.entity_oid = s.oid
          AND m.time BETWEEN s.from_time AND s.to_time
          AND m.type = 'IO_THROUGHPUT'
          AND m.time BETWEEN ($__timeFrom()::TIMESTAMPTZ - interval '7 day') AND date_trunc('day', $__timeTo()::TIMESTAMPTZ)
        GROUP BY m.time, m.entity_oid, m.utilization
      ),
      DATA AS (
        SELECT
          m.time,
          avg(m.utilization) AS avg_util
        FROM metrics m
        GROUP BY m.time
      )
      SELECT
        INTERVAL '1 DAY' + CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN date_trunc('day', time + interval '7 day')
          ELSE date_trunc('day', time)
        END as "time",
        CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN 'Previous Week'
          ELSE 'Week Ending ' || DATE($__timeTo()::TIMESTAMPTZ)::TEXT
        END as metric,
        avg(avg_util)
      FROM data
      GROUP BY 1, 2
      ORDER BY 1, 2
    refId: A
    select:
    - - params:
        - current
        type: column
    table: metric
    timeColumn: '"time"'
    timeColumnType: timestamp
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom: null
  timeRegions: []
  timeShift: null
  title: Physical Machine Avg IO Throughput Utilization - Week over Week by Day
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets: null
    mode: time
    name: null
    show: true
    values: []
  yaxes:
  - $$hashKey: object:419
    format: percentunit
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  - $$hashKey: object:420
    format: short
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  yaxis:
    align: false
    alignLevel: null
- aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  datasource: $DB
  decimals: 2
  description: Average Net Throughput utilization by physical machines
  fieldConfig:
    defaults:
      links: []
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 10
    w: 12
    x: 12
    y: 21
  hiddenSeries: false
  id: 14
  legend:
    alignAsTable: true
    avg: true
    current: false
    max: false
    min: false
    rightSide: false
    show: true
    total: false
    values: true
  lines: true
  linewidth: 2
  nullPointMode: "null"
  options:
    alertThreshold: true
  percentage: false
  pluginVersion: 8.0.6
  pointradius: 2
  points: true
  renderer: flot
  seriesOverrides:
  - $$hashKey: object:5835
    alias: Previous Week
    color: rgba(232, 0, 6, 0.5)
    dashes: true
    fill: 0
  - $$hashKey: object:5853
    alias: /Week Ending/
    color: '#56A64B'
  spaceLength: 10
  stack: false
  steppedLine: false
  targets:
  - format: time_series
    group: []
    metricColumn: none
    rawQuery: true
    rawSql: |-
      WITH metrics AS (
        SELECT m.time, m.utilization
        FROM metric m,
          scope_to($__timeFrom()::timestamptz - INTERVAL '7 day', $__timeTo(), 'PHYSICAL_MACHINE', ARRAY[${Group}]::bigint[], '${Group:raw}' = '0') s
        WHERE
          m.entity_oid = s.oid
          AND m.type = 'NET_THROUGHPUT'
          AND m.time BETWEEN ($__timeFrom()::TIMESTAMPTZ - interval '7 day') AND date_trunc('day', $__timeTo()::TIMESTAMPTZ)
        GROUP BY m.time, m.entity_oid, m.utilization
      ),
      DATA AS (
        SELECT
          m.time,
          avg(m.utilization) AS avg_util
        FROM metrics m
        GROUP BY m.time
      )
      SELECT
        INTERVAL '1 DAY' + CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN date_trunc('day', time + interval '7 day')
          ELSE date_trunc('day', time)
        END as "time",
        CASE
          WHEN time BETWEEN date_trunc('day', $__timeFrom()::TIMESTAMPTZ - interval '7 day')
            AND date_trunc('day', $__timeTo()::TIMESTAMPTZ - interval '7 day')
          THEN 'Previous Week'
          ELSE 'Week Ending ' || DATE($__timeTo()::TIMESTAMPTZ)::TEXT
        END as metric,
        avg(avg_util)
      FROM data
      GROUP BY 1, 2
      ORDER BY 1, 2
    refId: A
    select:
    - - params:
        - current
        type: column
    table: metric
    timeColumn: '"time"'
    timeColumnType: timestamp
    where:
    - name: $__timeFilter
      params: []
      type: macro
  thresholds: []
  timeFrom: null
  timeRegions: []
  timeShift: null
  title: Physical Machine Avg Net Throughput Utilization - Week over Week by Day
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets: null
    mode: time
    name: null
    show: true
    values: []
  yaxes:
  - $$hashKey: object:503
    format: percentunit
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  - $$hashKey: object:504
    format: short
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  yaxis:
    align: false
    alignLevel: null
refresh: false
schemaVersion: 30
style: dark
tags: []
templating:
  list:
  - description: null
    error: null
    hide: 2
    includeAll: false
    label: null
    multi: false
    name: DB
    options: []
    query: postgres
    queryValue: ""
    refresh: 1
    regex: ""
    skipUrlSync: false
    type: datasource
  - allValue: 0
    current: {}
    datasource: $DB
    definition: |-
      SELECT name as __text,
             oid as __value
      FROM entity
      WHERE entity.type = 'GROUP'
      AND ($__timeFrom(),$__timeTo()) OVERLAPS (first_seen, last_seen)
      AND attrs -> 'member_types' ? 'PHYSICAL_MACHINE'
      GROUP BY name, oid
      ORDER BY 1
    description: null
    error: null
    hide: 0
    includeAll: true
    label: null
    multi: false
    name: Group
    options: []
    query: |-
      SELECT name as __text,
             oid as __value
      FROM entity
      WHERE entity.type = 'GROUP'
      AND ($__timeFrom(),$__timeTo()) OVERLAPS (first_seen, last_seen)
      AND attrs -> 'member_types' ? 'PHYSICAL_MACHINE'
      GROUP BY name, oid
      ORDER BY 1
    refresh: 2
    regex: ""
    skipUrlSync: false
    sort: 0
    tagValuesQuery: ""
    tagsQuery: ""
    type: query
    useTags: false
time:
  from: now-7d
  to: now
timepicker:
  refresh_intervals:
  - 10s
  - 30s
  - 1m
  - 5m
  - 15m
  - 30m
  - 1h
  - 2h
  - 1d
timezone: ""
title: Physical Machine Utilization Week over Week by Day
uid: utilization_week_over_day
version: 3424
