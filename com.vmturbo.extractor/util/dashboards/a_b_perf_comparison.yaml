annotations:
  list:
    - builtIn: 1
      datasource: "-- Grafana --"
      enable: true
      hide: true
      iconColor: rgba(0, 211, 255, 1)
      name: Annotations & Alerts
      type: dashboard
description: Compare performance of dashboard query implementations
editable: true
gnetId:
graphTooltip: 0
iteration: 1614280390422
links: []
panels:
  - aliasColors: {}
    bars: false
    dashLength: 10
    dashes: false
    datasource: "$DB"
    fieldConfig:
      defaults:
        custom: {}
        links: []
      overrides: []
    fill: 0
    fillGradient: 0
    gridPos:
      h: 12
      w: 23
      x: 0
      y: 0
    hiddenSeries: false
    id: 6
    legend:
      avg: false
      current: false
      max: false
      min: false
      show: true
      total: false
      values: false
    lines: true
    linewidth: 2
    nullPointMode: null as zero
    percentage: false
    pluginVersion: 7.1.1
    pointradius: 3
    points: true
    renderer: flot
    seriesOverrides: []
    spaceLength: 10
    stack: false
    steppedLine: false
    targets:
      - format: time_series
        group: []
        metricColumn: none
        rawQuery: true
        rawSql: |
          SELECT
            timestamp '2019-12-31T05:00Z' + (b.end_time - b.start_time) as "time",
            b.label || ': ' || b.dashboard || '/' || b.name || case when coalesce(b.all_variable,True) then '[ALL]' else '' end as metric,
            b.execution_time/a.execution_time
          FROM
            grafana as b, grafana as a
          where
            a.trial = b.trial
            AND a.dashboard = b.dashboard
            AND a.query_type = b.query_type
            AND a.name = b.name
            AND a.all_variable = b.all_variable
            AND a.interval = b.interval
            AND b.trial = $trial
            AND b.label = '$b_label' AND a.label='$a_label'
            AND b.dashboard = any( array[ $dashboard ] )
            and b.query_type = any( array[ $type ] )
            and b.name = any( array [ $name ] )
            and ('$all' = 'Either' OR ('$all' = 'All Values') = b.all_variable)
          order by 1
        refId: A
        select:
          - - params:
                - current
              type: column
        table: metric
        timeColumn: '"time"'
        timeColumnType: timestamp
        where:
          - name: "$__timeFilter"
            params: []
            type: macro
    thresholds: []
    timeFrom:
    timeRegions:
      - colorMode: background6
        fill: true
        fillColor: rgba(234, 112, 112, 0.12)
        line: false
        lineColor: rgba(237, 46, 24, 0.60)
        op: time
    timeShift:
    title: Query time ratio - $b_label / $a_label
    tooltip:
      shared: true
      sort: 2
      value_type: individual
    type: graph
    xaxis:
      buckets:
      mode: time
      name:
      show: true
      values: []
    yaxes:
      - format:
        label:
        logBase: 1
        max:
        min:
        show: true
      - format: short
        label:
        logBase: 1
        max:
        min:
        show: true
    yaxis:
      align: false
      alignLevel:
  - datasource: "$DB"
    fieldConfig:
      defaults:
        custom:
          align:
        mappings:
          - from: ''
            id: 0
            operator: ''
            text: ''
            to: ''
            type: 1
        thresholds:
          mode: absolute
          steps:
            - color: green
              value:
            - color: red
              value: 80
        unit: none
      overrides:
        - matcher:
            id: byName
            options: execution_time
          properties:
            - id: unit
              value: ms
            - id: custom.width
              value: 117
        - matcher:
            id: byName
            options: dashboard
          properties:
            - id: custom.width
              value: 308
        - matcher:
            id: byName
            options: query_type
          properties:
            - id: custom.width
              value: 124
        - matcher:
            id: byName
            options: name
          properties:
            - id: custom.width
              value: 249
        - matcher:
            id: byName
            options: variable
          properties:
            - id: custom.width
              value: 239
        - matcher:
            id: byName
            options: B id
          properties:
            - id: custom.width
              value: 50
            - id: links
              value:
                - targetBlank: true
                  title: Link to Query Details for this query
                  url: "/d/query_details/query-panel?orgId=1&var-DB=${DB}&var-id=${__data.fields[B
            id]}"
        - matcher:
            id: byName
            options: A id
          properties:
            - id: unit
              value: none
            - id: custom.width
              value: 50
            - id: links
              value:
                - targetBlank: true
                  title: Link to Query Details for this query
                  url: "/d/query_details/query_panel?org_id=1&var-DB=${DB}&var-id=${__data.fields[A
            id]}"
        - matcher:
            id: byName
            options: time
          properties:
            - id: custom.width
              value: 200
        - matcher:
            id: byName
            options: interval
          properties:
            - id: custom.width
              value: 102
        - matcher:
            id: byName
            options: A/B match
          properties:
            - id: links
              value:
                - targetBlank: true
                  title: 'Link to details of A/B results and queries'
                  url: "/d/a_b_result_comparison?org_id=1&var-DB=${DB}\uFEFF\uFEFF\uFEFF\uFEFF&var-trial=\uFEFF\uFEFF${__data.fields[trial]}\uFEFF\uFEFF&var-a_label=\uFEFF\uFEFF${a_label}\uFEFF\uFEFF&var-b_label=\uFEFF${b_label}\uFEFF&var-a_id=${__data.fields[A
            id]}&var-b_id=${__data.fields[B id]}&var-dashboard=${__data.fields[dashboard]}&var-name=${__data.fields[name]}&var-query_type=${__data.fields[query_type]}&var-interval=${__data.fields[interval]}&var-all_values=${__data.fields[all_variable]}"
    gridPos:
      h: 12
      w: 23
      x: 0
      y: 12
    id: 2
    options:
      showHeader: true
      sortBy:
        - desc: true
          displayName: interval
    pluginVersion: 7.1.1
    targets:
      - format: table
        group: []
        metricColumn: none
        rawQuery: true
        rawSql: |
          SELECT
            a.id as "A id", b.id as "B id",
            $__time(a.time),
            a.trial,
            a.label as "A label",
            b.label as "B label",
            (a.end_time - a.start_time)::interval as interval,
            extract('epoch' from (a.end_time - a.start_time)::interval) as interval_secs,
            CASE WHEN coalesce(a.row_count, 0) = coalesce(b.row_count, 0) THEN '[n: ✔' ELSE '[n: ✘' END
              || CASE WHEN coalesce(a.row_data_hash, 0) = coalesce(b.row_data_hash, 0) THEN ', #: ✔]' ELSE ', #: ✘]' END
              AS "A/B match",
            b.execution_time / a.execution_time AS "B/A ratio",
            a.execution_time AS "A Time",
            b.execution_time AS "B Time",
            a.dashboard,
            a.query_type,
            a.name,
            a.all_variable,
            a.variable
          FROM
            grafana as a full outer join grafana as b
          ON
            a.trial = b.trial
            AND a.dashboard = b.dashboard
            AND a.query_type = b.query_type
            AND a.name = b.name
            AND a.all_variable = b.all_variable
            AND a.interval = b.interval
          where
            a.trial = $trial
            AND a.label = '$a_label'
            AND b.label = '$b_label'
            AND a.dashboard = any( array[ $dashboard ] )
            and a.query_type = any( array[ $type ] )
            and a.name = any( array [ $name ] )
            and ('$all' = 'Either' OR ('$all' = 'All Values') = a.all_variable)
            ORDER BY a.dashboard, a.query_type, a.name, a.interval::interval
        refId: A
        select:
          - - params:
                - execution_time
              type: column
        table: grafana
        timeColumn: '"time"'
        timeColumnType: timestamp
        where: []
    timeFrom:
    timeShift:
    title: 'Performance Overview - A: $a_label vs. B: $b_label'
    type: table
  - aliasColors: {}
    bars: false
    dashLength: 10
    dashes: false
    datasource: "$DB"
    fieldConfig:
      defaults:
        custom: {}
        links: []
      overrides: []
    fill: 0
    fillGradient: 0
    gridPos:
      h: 12
      w: 23
      x: 0
      y: 24
    hiddenSeries: false
    id: 4
    legend:
      avg: false
      current: false
      max: false
      min: false
      show: true
      total: false
      values: false
    lines: true
    linewidth: 2
    nullPointMode: null as zero
    percentage: false
    pluginVersion: 7.1.1
    pointradius: 3
    points: true
    renderer: flot
    seriesOverrides: []
    spaceLength: 10
    stack: false
    steppedLine: false
    targets:
      - format: time_series
        group: []
        metricColumn: none
        rawQuery: true
        rawSql: |+
          SELECT
            timestamp '2019-12-31T05:00Z' + (end_time - start_time) as "time",
            label || ': ' || dashboard || '/' || name || case when coalesce(all_variable,True) then '[ALL]' else '' end as metric,
            execution_time
          FROM
            grafana
          where
            trial = $trial
            AND label = '$a_label'
            AND dashboard = any( array[ $dashboard ] )
            and query_type = any( array[ $type ] )
            and name = any( array [ $name ] )
            and ('$all' = 'Either' OR ('$all' = 'All Values') = all_variable)
          order by 1

        refId: A
        select:
          - - params:
                - current
              type: column
        table: metric
        timeColumn: '"time"'
        timeColumnType: timestamp
        where:
          - name: "$__timeFilter"
            params: []
            type: macro
    thresholds: []
    timeFrom:
    timeRegions:
      - colorMode: background6
        fill: true
        fillColor: rgba(234, 112, 112, 0.12)
        line: false
        lineColor: rgba(237, 46, 24, 0.60)
        op: time
    timeShift:
    title: Query time by interval - $a_label
    tooltip:
      shared: true
      sort: 2
      value_type: individual
    type: graph
    xaxis:
      buckets:
      mode: time
      name:
      show: true
      values: []
    yaxes:
      - format: ms
        label:
        logBase: 1
        max:
        min:
        show: true
      - format: short
        label:
        logBase: 1
        max:
        min:
        show: true
    yaxis:
      align: false
      alignLevel:
  - aliasColors: {}
    bars: false
    dashLength: 10
    dashes: false
    datasource: "$DB"
    fieldConfig:
      defaults:
        custom: {}
        links: []
      overrides: []
    fill: 0
    fillGradient: 0
    gridPos:
      h: 12
      w: 23
      x: 0
      y: 36
    hiddenSeries: false
    id: 5
    legend:
      avg: false
      current: false
      max: false
      min: false
      show: true
      total: false
      values: false
    lines: true
    linewidth: 2
    nullPointMode: null as zero
    percentage: false
    pluginVersion: 7.1.1
    pointradius: 3
    points: true
    renderer: flot
    seriesOverrides: []
    spaceLength: 10
    stack: false
    steppedLine: false
    targets:
      - format: time_series
        group: []
        metricColumn: none
        rawQuery: true
        rawSql: |+
          SELECT
            timestamp '2019-12-31T05:00Z' + (end_time - start_time) as "time",
            label || ': ' || dashboard || '/' || name || case when coalesce(all_variable,True) then '[ALL]' else '' end as metric,
            execution_time
          FROM
            grafana
          where
            trial = $trial
            AND label = '$b_label'
            AND dashboard = any( array[ $dashboard ] )
            and query_type = any( array[ $type ] )
            and name = any( array [ $name ] )
            and ('$all' = 'Either' OR ('$all' = 'All Values') = all_variable)
          order by 1

        refId: A
        select:
          - - params:
                - current
              type: column
        table: metric
        timeColumn: '"time"'
        timeColumnType: timestamp
        where:
          - name: "$__timeFilter"
            params: []
            type: macro
    thresholds: []
    timeFrom:
    timeRegions:
      - colorMode: background6
        fill: true
        fillColor: rgba(234, 112, 112, 0.12)
        line: false
        lineColor: rgba(237, 46, 24, 0.60)
        op: time
    timeShift:
    title: Query time by interval - $b_label
    tooltip:
      shared: true
      sort: 2
      value_type: individual
    type: graph
    xaxis:
      buckets:
      mode: time
      name:
      show: true
      values: []
    yaxes:
      - format: ms
        label:
        logBase: 1
        max:
        min:
        show: true
      - format: short
        label:
        logBase: 1
        max:
        min:
        show: true
    yaxis:
      align: false
      alignLevel:
refresh: false
schemaVersion: 26
style: dark
tags: []
templating:
  list:
    - hide: 0
      includeAll: false
      label:
      multi: false
      name: DB
      options: []
      query: postgres
      queryValue: ''
      refresh: 1
      regex: ''
      skipUrlSync: false
      type: datasource
    - allValue:
      datasource: "$DB"
      definition: SELECT DISTINCT trial FROM grafana
      hide: 0
      includeAll: false
      label: trial
      multi: false
      name: trial
      options: []
      query: SELECT DISTINCT trial FROM grafana
      refresh: 2
      regex: ''
      skipUrlSync: false
      sort: 3
      tagValuesQuery: ''
      tags: []
      tagsQuery: ''
      type: query
      useTags: false
    - allValue:
      datasource: "$DB"
      definition: SELECT DISTINCT label FROM grafana WHERE trial = ${trial}
      hide: 0
      includeAll: false
      label: '"A" label'
      multi: false
      name: a_label
      options: []
      query: SELECT DISTINCT label FROM grafana WHERE trial = ${trial}
      refresh: 2
      regex: ''
      skipUrlSync: false
      sort: 5
      tagValuesQuery: ''
      tags: []
      tagsQuery: ''
      type: query
      useTags: false
    - allValue:
      datasource: "$DB"
      definition: SELECT DISTINCT label FROM grafana WHERE trial = ${trial}
      hide: 0
      includeAll: false
      label: '"B" label'
      multi: false
      name: b_label
      options: []
      query: SELECT DISTINCT label FROM grafana WHERE trial = ${trial}
      refresh: 2
      regex: ''
      skipUrlSync: false
      sort: 5
      tagValuesQuery: ''
      tags: []
      tagsQuery: ''
      type: query
      useTags: false
    - allValue: ''
      datasource: "$DB"
      definition: |-
        SELECT DISTINCT dashboard FROM grafana
        WHERE trial = ${trial}
          AND label in ('${a_label}', '${b_label}')
      hide: 0
      includeAll: true
      label:
      multi: true
      name: dashboard
      options: []
      query: |-
        SELECT DISTINCT dashboard FROM grafana
        WHERE trial = ${trial}
          AND label in ('${a_label}', '${b_label}')
      refresh: 2
      regex: ''
      skipUrlSync: false
      sort: 5
      tagValuesQuery: ''
      tags: []
      tagsQuery: ''
      type: query
      useTags: false
    - allValue: ''
      datasource: "$DB"
      definition: |-
        SELECT DISTINCT query_type FROM grafana
          WHERE trial = ${trial}
            AND label in ('${a_label}', '${b_label}')
            AND dashboard = any(ARRAY[${dashboard}])
      hide: 0
      includeAll: true
      label: 'Query Type '
      multi: true
      name: type
      options: []
      query: |-
        SELECT DISTINCT query_type FROM grafana
          WHERE trial = ${trial}
            AND label in ('${a_label}', '${b_label}')
            AND dashboard = any(ARRAY[${dashboard}])
      refresh: 2
      regex: ''
      skipUrlSync: false
      sort: 5
      tagValuesQuery: ''
      tags: []
      tagsQuery: ''
      type: query
      useTags: false
    - allValue: ''
      datasource: "$DB"
      definition: |-
        SELECT DISTINCT name FROM grafana
          WHERE trial = ${trial}
            AND label in ('${a_label}', '${b_label}')
            AND dashboard = any(ARRAY[${dashboard}])
            AND quer_type = any(ARRAY[$type])
      hide: 0
      includeAll: true
      label: Panel or Var Name
      multi: true
      name: name
      options: []
      query: |-
        SELECT DISTINCT name FROM grafana
          WHERE trial = ${trial}
            AND label in ('${a_label}', '${b_label}')
            AND dashboard = any(ARRAY[${dashboard}])
            AND query_type = any(ARRAY[$type])
      refresh: 2
      regex: ''
      skipUrlSync: false
      sort: 5
      tagValuesQuery: ''
      tags: []
      tagsQuery: ''
      type: query
      useTags: false
    - allValue:
      hide: 0
      includeAll: false
      label: Var Values
      multi: false
      name: all
      options:
        - selected: false
          text: All Values
          value: All Values
        - selected: false
          text: Explicit Values
          value: Explicit Values
        - selected: false
          text: Either
          value: Either
      query: All Values,Explicit Values,Either
      queryValue: ''
      skipUrlSync: false
      type: custom
time:
  from: '2020-01-01T05:00:00.000Z'
  to: '2020-06-02T03:59:59.000Z'
timepicker:
  refresh_intervals:
    - 10s
    - 30s
    - 1m
    - 5m
    - 15m
    - 30m
    - 1h
    - 2h
    - 1d
timezone: ''
title: A/B Performance Comparison
uid: a_b_perf_comparison
