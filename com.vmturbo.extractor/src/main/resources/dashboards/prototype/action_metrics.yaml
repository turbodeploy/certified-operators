---
annotations:
  list:
  - builtIn: 1
    datasource: -- Grafana --
    enable: true
    hide: true
    iconColor: rgba(0, 211, 255, 1)
    name: Annotations & Alerts
    type: dashboard
description: This dashboard displays current scaling actions for virtual machines
  in your on-prem environment.
editable: true
gnetId: null
graphTooltip: 0
iteration: 1619467893469
links: []
panels:
- datasource: $DB
  fieldConfig:
    defaults:
      custom:
        align: null
        filterable: false
      mappings: []
      thresholds:
        mode: absolute
        steps:
        - color: green
          value: null
        - color: red
          value: 80
    overrides:
    - matcher:
        id: byName
        options: Peak VMem
      properties:
      - id: unit
        value: kbytes
      - id: custom.width
        value: 118
    - matcher:
        id: byName
        options: Peak VCPU
      properties:
      - id: unit
        value: hertz
    - matcher:
        id: byName
        options: Action Details
      properties:
      - id: custom.width
        value: 328
    - matcher:
        id: byName
        options: From
      properties:
      - id: custom.width
        value: 73
    - matcher:
        id: byName
        options: To
      properties:
      - id: custom.width
        value: 70
    - matcher:
        id: byName
        options: Resource Type
      properties:
      - id: custom.width
        value: 108
    - matcher:
        id: byName
        options: Resize Type
      properties:
      - id: custom.width
        value: 108
    - matcher:
        id: byName
        options: Host Cluster
      properties:
      - id: custom.width
        value: 259
    - matcher:
        id: byName
        options: Unit
      properties:
      - id: custom.width
        value: 63
    - matcher:
        id: byName
        options: VM Name
      properties:
      - id: custom.width
        value: 225
    - matcher:
        id: byName
        options: target_entity_id
      properties:
      - id: custom.width
        value: 141
    - matcher:
        id: byName
        options: action_oid
      properties:
      - id: custom.width
        value: 188
    - matcher:
        id: byName
        options: description
      properties:
      - id: custom.width
        value: 264
    - matcher:
        id: byName
        options: before_action
      properties:
      - id: custom.width
        value: 312
    - matcher:
        id: byName
        options: affected_metric
      properties:
      - id: custom.width
        value: 142
    - matcher:
        id: byName
        options: from_entity
      properties:
      - id: custom.width
        value: 125
    - matcher:
        id: byName
        options: to_entity
      properties:
      - id: custom.width
        value: 132
    - matcher:
        id: byName
        options: from_before_metric
      properties:
      - id: custom.width
        value: 93
    - matcher:
        id: byName
        options: from_after_metric
      properties:
      - id: custom.width
        value: 130
    - matcher:
        id: byName
        options: to_before_metric
      properties:
      - id: custom.width
        value: 165
  gridPos:
    h: 15
    w: 24
    x: 0
    y: 0
  id: 2
  options:
    showHeader: true
    sortBy:
    - desc: true
      displayName: to_entity
  pluginVersion: 7.3.8
  targets:
  - format: table
    group: []
    hide: false
    metricColumn: none
    rawQuery: true
    rawSql: |-
      WITH action_data AS (
        SELECT
          action_oid,
          description,
          commType as affected_metric,
          jsonb_extract_path_text(attrs -> actionTypeInfo -> entType -> 'from', 'name') || jsonb_extract_path_text(attrs -> actionTypeInfo -> entType -> 'from', 'oid') as from_entity,
          jsonb_extract_path_text(attrs -> actionTypeInfo -> entType -> 'to', 'name') || jsonb_extract_path_text(attrs -> actionTypeInfo -> entType -> 'to', 'oid')  as to_entity,
          jsonb_extract_path_text(attrs -> actionTypeInfo -> entType -> 'from' -> 'affectedMetrics' -> commType, 'beforeActions') as from_before_metric,
          jsonb_extract_path_text(attrs -> actionTypeInfo -> entType -> 'from' -> 'affectedMetrics' -> commType, 'afterActions') as from_after_metric,
          jsonb_extract_path_text(attrs -> actionTypeInfo -> entType -> 'to' -> 'affectedMetrics' -> commType, 'beforeActions') as to_before_metric,
          jsonb_extract_path_text(attrs -> actionTypeInfo -> entType -> 'to' -> 'affectedMetrics' -> commType, 'afterActions') as to_after_metric,
          entType
        FROM (
          SELECT
            action_oid,
            target_entity_id,
            attrs -> actType.key as move_info,
            jsonb_object_keys(attrs -> actType.key) as resource_type,
            jsonb_object_keys(attrs -> actType.key -> entType.key -> 'to' -> 'affectedMetrics') as commType,
            description,
            actType.key as actionTypeInfo,
            entType.key as entType,
            attrs as attrs
          FROM pending_action JOIN jsonb_each(attrs) actType ON true JOIN jsonb_each(attrs -> 'moveInfo') entType ON true
          WHERE type = 'MOVE') as move_actions
        )
      SELECT * FROM action_data WHERE
        CASE
          WHEN ARRAY[ $MoveType ] = ARRAY[ '0' ] THEN true
          ELSE entType = $MoveType
        END
    refId: B
    select:
    - - params:
        - value
        type: column
    timeColumn: time
    where:
    - name: $__timeFilter
      params: []
      type: macro
  timeFrom: null
  timeShift: null
  title: Move Recommendations
  type: table
schemaVersion: 26
style: dark
tags: []
templating:
  list:
  - hide: 0
    includeAll: false
    label: null
    multi: false
    name: DB
    options: []
    query: postgres
    refresh: 1
    regex: ""
    skipUrlSync: false
    type: datasource
  - allValue: '''0'''
    current:
      selected: true
      text: STORAGE
      value: STORAGE
    datasource: $DB
    definition: |-
      SELECT DISTINCT jsonb_object_keys(pending_action.attrs -> 'moveInfo')
      FROM pending_action
    error: null
    hide: 0
    includeAll: true
    label: null
    multi: false
    name: MoveType
    options:
    - selected: false
      text: All
      value: $__all
    - selected: false
      text: PHYSICAL_MACHINE
      value: PHYSICAL_MACHINE
    - selected: true
      text: STORAGE
      value: STORAGE
    - selected: false
      text: VIRTUAL_MACHINE
      value: VIRTUAL_MACHINE
    query: |-
      SELECT DISTINCT jsonb_object_keys(pending_action.attrs -> 'moveInfo')
      FROM pending_action
    refresh: 0
    regex: ""
    skipUrlSync: false
    sort: 0
    tagValuesQuery: ""
    tags: []
    tagsQuery: ""
    type: query
    useTags: false
time:
  from: now-6h
  to: now
timepicker:
  refresh_intervals:
  - 10s
  - 30s
  - 1m
  - 5m
  - 15m
  - 30m
  - 1h
  - 2h
  - 1d
timezone: ""
title: Move recommendations
uid: action_metrics
